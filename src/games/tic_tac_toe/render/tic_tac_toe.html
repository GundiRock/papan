<dom-module id="ttt-square-circle">
  <template>
    <div>
      <svg height="124px" width="124px">
        <circle cx="60px" cy="60px" r="55px" stroke="red" stroke-width="4px" fill-opacity="0" />
      </svg>
    </div>
  </template>

  <style>
    div {
      width: 128px;
      height: 128px;
    }
  </style>

  <script>
    Polymer({
      is: "ttt-square-circle"
    })
  </script>
</dom-module>

<dom-module id="ttt-square-cross">
  <template>
    <div>
      <svg height="124px" width="124px">
        <line x1="4" y1="4" x2="120" y2="120" stroke="green" stroke-width="4px" />
        <line x1="4" y1="120" x2="120" y2="4" stroke="green" stroke-width="4px" />
      </svg>
    </div>
  </template>

  <style>
    div {
      width: 128px;
      height: 128px;
    }
  </style>

  <script>
    Polymer({
      is: "ttt-square-cross"
    })
  </script>
</dom-module>

<dom-module id="ttt-square-empty">
  <template>
    <div>
      <svg height="124px" width="124px">
        <circle cx="60px" cy="60px" r="55px" stroke="#ddd" stroke-width="4px" fill-opacity="0" />
        <line x1="4" y1="4" x2="120" y2="120" stroke="#ddd" stroke-width="4px" />
        <line x1="4" y1="120" x2="120" y2="4" stroke="#ddd" stroke-width="4px" />
      </svg>
    </div>
  </template>

  <style>
    div {
      width: 128px;
      height: 128px;
    }
  </style>

  <script>
    Polymer({
      is: "ttt-square-empty"
    })
  </script>
</dom-module>

<dom-module id="ttt-square">
  <template>
    <div>
      <ttt-square-circle id="circle" class="square"></ttt-square-circle>
      <ttt-square-cross id="cross" class="square"></ttt-square-cross>
      <ttt-square-empty id="empty" class="square"></ttt-square-empty>
    </div>
  </template>

  <style>
    .square {
      width: 128px;
      height: 128px;
      display: none;
    }
  </style>

  <script>
    Polymer({
      is: "ttt-square",

      _actor: {},

      listeners: {
        'action': 'actionFired'
      },

      showCircle: function() {
        this.$.circle.style.display = 'inline'
        this.$.cross.style.display = 'none'
        this.$.empty.style.display = 'none'
      },

      showCross: function() {
        this.$.circle.style.display = 'none'
        this.$.cross.style.display = 'inline'
        this.$.empty.style.display = 'none'
      },

      showEmpty: function() {
        this.$.circle.style.display = 'none'
        this.$.cross.style.display = 'none'
        this.$.empty.style.display = 'inline'
      },

      actionFired: function(evcent) {
        alert('xyz')
      },

      attachActor: function(actor) {
        this._actor = actor
        switch(actor.class[0]) {
        case 'circle':
          this.showCircle()
          break
        case 'cross':
          this.showCross()
          break
        case 'empty':
          this.showEmpty()
          break
        }
      }
    })
  </script>
</dom-module>

<dom-module id="papan-main-board">
  <template>
    <mdl-card class="board" shadow="4">
      <table>
        <tr>
          <td><ttt-square id="s00" class="square"></ttt-square></td>
          <td><ttt-square id="s01" class="square"></ttt-square></td>
          <td><ttt-square id="s02" class="square"></ttt-square></td>
        </tr>
        <tr>
          <td><ttt-square id="s10" class="square"></ttt-square></td>
          <td><ttt-square id="s11" class="square"></ttt-square></td>
          <td><ttt-square id="s12" class="square"></ttt-square></td>
        </tr>
        <tr>
          <td><ttt-square id="s20" class="square"></ttt-square></td>
          <td><ttt-square id="s21" class="square"></ttt-square></td>
          <td><ttt-square id="s22" class="square"></ttt-square></td>
        </tr>
      </table>
    </mdl-card>
  </template>

  <style>
    .board.mdl-card {
      width: 384px;
      height: 402px;
    }

    td {
      width: 128px;
      height: 128px;
      border: 1px;
      border-style: solid;
      border-color: black;
    }

    .square {
      width: 128px;
      height: 128px;
    }
  </style>

  <script>
    Polymer({
      is: "papan-main-board",

      created: function() {
        this._publicScene = {}
      },

      attached: function() {
        this.fire('view-ready')
      },

      applyPublicDelta: function(delta) {
        let element = this
        delta.forEach((change) => {
          DeepDiff.applyChange(element._publicScene, {}, change)
        })

        for (let x = 0; x < 3; x++) {
          for (let y = 0; y < 3; y++) {
            let sourceName = 'space_' + x + "_" + y
            let destName = 's' + x + y
            let actor = this._publicScene[sourceName]
            let element = this.$[destName]
            element.attachActor(actor)
          }
        }
      },

      applyPrivateDelta: function(delta, player) {}
    })
  </script>
</dom-module>
